{% extends "base.html" %}
{% block content %}
<body>
    <div class="admin-home">
        <h1>Create A Test</h1>
        <h2>Please review instructions below to create new tests.</h2>
    </div>

    <details class="instructions-container" open>
        <summary class="instructions-header"><h1>Instructions</h1></summary>
            <div class="instructions-content">
            <p>This page allows admin users to create new tests.</p>
            <h3>Step One</h3>
            <p>Enter a name for the test (e.g., 'Week One').</p>
            <h3>Step Two</h3>
            <p>Upload Italian audio file.</p>
            <h3>Step Three</h3>
            <p>Select a difficulty rating (Low, Medium, High).</p>
            <h3>Step Four</h3>
            <p>Set a due date.</p>
            <h3>Step Five</h3>
            <p>Click 'Upload Test'.</p>
            </div>
    </details>
<div class="addtest">
    <form id="test-form" enctype="multipart/form-data" method="POST" action={{ url_for('upload_files') }}>
        <label for="test-name">Test Name:</label>
        <input type="text" id="test-name" name="testName" required>
        <div id="file-uploads">
            <div class="file-upload" data-difficulty="low">
                <label for="low-difficulty-file">Upload Low Difficulty File:</label>
                <input type="file" id="low-difficulty-file" name="lowDifficultyFile" accept=".mp3,.m4a,.wav" multiple required>
<div id="selected-files-low"></div>
            </div>
            <!-- Add these two divs below your file upload input fields -->


            <div class="file-upload" data-difficulty="medium">
                <label for="medium-difficulty-file">Upload Medium Difficulty File:</label>
                <input type="file" id="medium-difficulty-file" name="mediumDifficultyFile" accept=".mp3,.m4a,.wav" multiple required>
<div id="selected-files-medium"></div>
            </div>
            <!-- Add these two divs below your file upload input fields -->


            <div class="file-upload" data-difficulty="high">
                <label for="high-difficulty-file">Upload High Difficulty File:</label>
                <input type="file" id="high-difficulty-file" name="highDifficultyFile" accept=".mp3,.m4a,.wav" multiple required>
<div id="selected-files-high"></div>
            </div>
        </div>

        <!-- Due Date -->
        <h4>Due Date:</h4>
        <input type="date" id="due-date" name="dueDate" required>

        <button type="submit">Upload Test</button>
    </form>
</div>
<script>


    // Function to display the selected files and audio players
    function displaySelectedFiles(inputId, containerId) {
        const fileInput = document.getElementById(inputId);
        const container = document.getElementById(containerId);
        container.innerHTML = "";

        for (const file of fileInput.files) {
            const fileDiv = document.createElement("div");

            // Display the selected file name
            const fileNameParagraph = document.createElement("p");
            fileNameParagraph.textContent = `File Name: ${file.name}`;
            fileDiv.appendChild(fileNameParagraph);

            // Display an audio player for audio files
            if (file.type.startsWith("audio/")) {
                const audioElement = document.createElement("audio");
                audioElement.controls = true;
                audioElement.src = URL.createObjectURL(file);
                fileDiv.appendChild(audioElement);
            }

            container.appendChild(fileDiv);
        }
    }

    // Attach event listeners to handle file selection and display for each difficulty level
    document.getElementById("low-difficulty-file").addEventListener("change", function () {
        displaySelectedFiles("low-difficulty-file", "selected-files-low");
    });

    document.getElementById("medium-difficulty-file").addEventListener("change", function () {
        displaySelectedFiles("medium-difficulty-file", "selected-files-medium");
    });

    document.getElementById("high-difficulty-file").addEventListener("change", function () {
        displaySelectedFiles("high-difficulty-file", "selected-files-high");
    });



document.getElementById("test-form").addEventListener("submit", function (event) {
    event.preventDefault();  // Prevent the default form submission

    const formData = new FormData(this);

    fetch("/upload_files", {
        method: "POST",
        body: formData,
    })
    .then((response) => response.json())
    .then((data) => {
        // Handle the response data if needed (e.g., display uploaded file paths)
        alert("File(s) uploaded successfully!");
        console.log(data);
    })
    .catch((error) => {
        // Handle any errors that occur during the upload
        console.error(error);
    });
});

</script>



</body>

{% endblock %}