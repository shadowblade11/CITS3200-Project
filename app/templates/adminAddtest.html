{% extends "base.html" %}
{% block content %}
<body>
    <div class="admin-home">
        <h1>Create A Test</h1>
        <h2>Please review instructions below to create new tests.</h2>
    </div>

    <details class="instructions-container" open>
        <summary class="instructions-header"><h1>Instructions</h1></summary>
            <div class="instructions-content">
            <p>This page allows admin users to create new tests.</p>
            <h3>Step One</h3>
            <p>Enter a name for the test (e.g., 'Week One').</p>
            <h3>Step Two</h3>
            <p>Upload Italian audio file.</p>
            <h3>Step Three</h3>
            <p>Select a difficulty rating (Low, Medium, High).</p>
            <h3>Step Four</h3>
            <p>Set a due date.</p>
            <h3>Step Five</h3>
            <p>Click 'Upload Test'.</p>
            </div>
    </details>

    <div class="addtest">
        <form id="test-form" enctype="multipart/form-data" method="POST" action={{ url_for('upload_files') }}>
            <label for="test-name">Test Name:</label>
            <input type="text" id="test-name" name="testName" required>
            
            <label for="file-upload">Upload File:</label>
            <input type="file" id="file-upload" name="testFiles" accept=".mp3,.m4a,.wav" multiple required>
            <div id="audio-container"></div>

            <div class="test-factors">
                <label for="difficulty">Difficulty:</label>
                <select id="difficulty" name="difficulty" required>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
                <h4>Due Date:</h4>
                <input type="date" id="due-date" name="dueDate" required>
            </div>

            <button type="submit">Upload Test</button>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        const uploadButton = document.getElementById("upload-button");

        uploadButton.addEventListener("click", function () {
            const testName = document.getElementById("test-name").value;
            const fileInput = document.getElementById("file-upload");
            const selectedFile = fileInput.files[0];
            const difficulty = document.getElementById("difficulty").value
            const dueDate = document.getElementById("due-date").value

            if (!selectedFile) {
                alert("Please select a file to upload.");
                return;
            }

            const formData = new FormData();
            formData.append("testName", testName);
            formData.append("testFile", selectedFile);
            formData.append("difficulty", difficulty)
            formData.append("dueDate", dueDate)

            fetch("/", {
                method: "POST",
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById("upload-status").textContent = data;
            })
            .catch(error => {
                console.error(error);
                alert("An error occurred while uploading the file.");
            });
        });
    });

   //display select audio file
    function displaySelectedAudioFiles() {
        const fileInput = document.querySelector("#file-upload");
        const audioContainer = document.querySelector("#audio-container");
        audioContainer.innerHTML = "";
        for (const file of fileInput.files) {
            const fileDiv = document.createElement("div");
            const audioElement = document.createElement("audio");
            audioElement.controls = true;
            audioElement.src = URL.createObjectURL(file);
            const fileNameParagraph = document.createElement("p");
            fileNameParagraph.textContent = `File Name: ${file.name}`;
            fileDiv.appendChild(fileNameParagraph);
            fileDiv.appendChild(audioElement);
            audioContainer.appendChild(fileDiv);
        }
    }
    const fileInput = document.querySelector("#file-upload");
    fileInput.addEventListener("change", displaySelectedAudioFiles);
</script>
</div>

{% endblock %}